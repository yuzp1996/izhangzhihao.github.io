****
#### SQL分类

SQL 语句主要可以划分为以下 3 个类别。




|特性  |DDL |DML |DCL|
|---| --- | ---|---|
|定义|数据定义语言|数据操纵语句|数据控制语句|
|作用|定义了不同的数据段、数据库、表、列、索引等数据库对象的定义|用于添加、删除、更新和查询数据库记录，并检查数据完整性|数据控制语句，用于控制不同数据段直接的许可和访问级别的语句。这些语句定义了数据库、表、字段、用户的访问权限和安全级别|
|关键字|create、drop、alter等。| insert、delete、udpate 和select 等。|grant、revoke|
|特性|DDL 语句更多的被数据库管理员（DBA）所使用|DML 只是对表内部数据的操作||

*****
### 关键语法

>CREATE DATABASE dbname;

[可能出现的问题](http://blog.sina.com.cn/s/blog_7d553bb50102w9rb.html)

>show databases;

安装MySQL 时系统自动创建的，其各自功能如下。

|表名|information_schema|cluster|mysql|test|
|----|----|----|----|----|
|功能|主要存储了系统中的一些数据库对象信息。比如用户表信息、列信息、权限信息、字符集信息、分区信息等。|存储了系统的集群信息|存储了系统的用户权限信息。|系统自动创建的测试数据库，任何用户都可以使用|


> USE dbname;

> show tables;

删库
>drop database dbname;

在数据库中创建一张表的基本语法如下：

```
CREATE TABLE tablename (column_name_1 column_type_1 constraints，column_name_2  column_type_2  constraints ， ……column_name_n  column_type_n
constraints）

实例	>create table emp(ename varchar(10),hiredate date,sal decimal(10,2),deptno int(2));

```

表创建完毕后，如果需要查看一下表的定义，可以使用如下命令：

>DESC tablename

```
mysql> desc emp;
+----------+---------------+------+-----+---------+-------+
| Field | Type | Null | Key | Default | Extra |
+----------+---------------+------+-----+---------+-------+
| ename | varchar(10) | YES | | | |
| hiredate | date | YES | | | |
| sal | decimal(10,2) | YES | | | |
| deptno | int(2) | YES | | | |
+----------+---------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

详细：更详细，比如存储引擎，字符集

>show create table emp \G;

```
mysql> show create table emp \G;
*************************** 1. row ***************************
Table: emp
Create Table: CREATE TABLE `emp` (
`ename` varchar(20) DEFAULT NULL,
`hiredate` date DEFAULT NULL,
`sal` decimal(10,2) DEFAULT NULL,
`deptno` int(2) DEFAULT NULL,
```


删除表

>DROP TABLE tablename


*****

#### 在大多数情况下，表结构的更改一般都使用 alter table 语句，以下是一些常用的命令。

（1） 修改表类型，语法如下：

>ALTER TABLE tablename MODIFY [COLUMN] column_definition [FIRST | AFTER col_name]

修改表 emp 的 ename 字段定义，将 varchar(10)改为 varchar(20)

```alter table emp modify ename varchar(20);```

（2）增加表字段，语法如下：

>ALTER TABLE tablename ADD [COLUMN] column_definition [FIRST | AFTER col_name]

例如，表 emp 上新增加字段 age，类型为 int(3)

```alter table emp add column age int(3);```

（3）删除表字段，语法如下：

>ALTER TABLE tablename DROP [COLUMN] col_name

例如，将字段 age 删除掉：

mysql> alter table emp drop column age;


注意：change 和 modify都可以修改表的定义，不同的是 change 后面需要写两次列名，不方便。
但是 change 的优点是可以修改列名称，modify则不能。


（5）修改字段排列顺序。

前面介绍的的字段增加和修改语法（ADD/CNAHGE/MODIFY）中，都有一个可选项 first|after
column_name，这个选项可以用来修改字段在表中的位置，默认 ADD 增加的新字段是加在
表的最后位置，而 CHANGE/MODIFY 默认都不会改变字段的位置。

例如，将新增的字段 birth date 加在 ename 之后：

>alter table emp add birth date after ename;

修改字段 age，将它放在最前面：

>mysql> alter table emp modify age int(3) first;

（6）表改名，语法如下：

>ALTER TABLE tablename RENAME [TO] new_tablename

例如，将表 emp 改名为 emp1，命令如下：

>mysql> alter table emp rename emp1;































*****

（4）聚合。
很多情况下，我们需要进行一些汇总操作，比如统计整个公司的人数或者统计每个部门的人
数，这个时就要用到 SQL 的聚合操作。


聚合操作的语法如下：

```
SELECT [field1,field2,……fieldn] fun_name
FROM tablename
[WHERE where_contition]
[GROUP BY field1,field2,……fieldn
[WITH ROLLUP]]
[HAVING where_contition]

```
对其参数进行以下说明。

1 fun_name 表示要做的聚合操作，也就是聚合函数，常用的有 sum（求和）、count(*)（记
录数）、max（最大值）、min（最小值）。

2 GROUP BY 关键字表示要进行分类聚合的字段，比如要按照部门分类统计员工数量，部门
就应该写在 group by 后面。

3 WITH ROLLUP 是可选语法，表明是否对分类聚合后的结果进行再汇总。

4 HAVING 关键字表示对分类后的结果再进行条件的过滤


```
注意：having 和 where 的区别在于 having 是对聚合后的结果进行条件的过滤，而 where 是在聚
合前就对记录进行过滤，如果逻辑允许，我们尽可能用 where 先过滤记录，这样因为结果
集减小，将对聚合的效率大大提高，最后再根据逻辑看是否用 having 进行再过滤。
```

```
例如，要 emp 表中统计公司的总人数：
mysql> select count(1) from emp;
+----------+
| count(1) |
+----------+
| 4 |
+----------+
1 row in set (0.00 sec)
在此基础上，要统计各个部门的人数：
mysql> select deptno,count(1) from emp group by deptno;
+--------+----------+
| deptno | count(1) |
+--------+----------+
| 1 | 2 |
| 2 | 1 |
| 4 | 1 |
+--------+----------+
3 rows in set (0.00 sec)
更细一些，既要统计各部门人数，又要统计总人数：
mysql> select deptno,count(1) from emp group by deptno with rollup;
+--------+----------+
| deptno | count(1) |
+--------+----------+
| 1 | 2 |
| 2 | 1 |
| 4 | 1 |
| NULL | 4 |
+--------+----------+
4 rows in set (0.00 sec)
统计人数大于 1 人的部门：
mysql> select deptno,count(1) from emp group by deptno having count(1)>1;
+--------+----------+
| deptno | count(1) |
+--------+----------+
| 1 | 2 |
+--------+----------+
1 row in set (0.00 sec)
最后统计公司所有员工的薪水总额、最高和最低薪水：
mysql> select * from emp;
+--------+------------+---------+--------+
| ename | hiredate | sal | deptno |
+--------+------------+---------+--------+
| zzx | 2000-01-01 | 100.00 | 1 |
| lisa | 2003-02-01 | 400.00 | 2 |
| bjguan | 2004-04-02 | 100.00 | 1 |
| dony | 2005-02-05 | 2000.00 | 4 |
+--------+------------+---------+--------+
4 rows in set (0.00 sec)
mysql> select sum(sal),max(sal),min(sal) from emp;
+----------+----------+----------+
| sum(sal) | max(sal) | min(sal) |
+----------+----------+----------+
| 2600.00 | 2000.00 | 100.00 |
+----------+----------+----------+
1 row in set (0.00 sec
```